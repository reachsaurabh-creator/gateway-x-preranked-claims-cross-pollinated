<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chart Debug Test</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .chart { width: 100%; height: 200px; border: 2px solid #333; background: #f0f0f0; }
        .debug { margin: 10px 0; padding: 10px; background: #e8f4f8; border: 1px solid #2563eb; }
    </style>
</head>
<body>
    <h1>Chart Debug Test</h1>
    
    <div class="debug">
        <h3>Test Data:</h3>
        <div id="test-data"></div>
    </div>
    
    <div class="debug">
        <h3>Chart Canvas:</h3>
        <canvas class="chart" id="convergenceChart"></canvas>
        <div id="chart-debug"></div>
    </div>

    <script>
        // Test data
        const testTimeline = [
            { round_index: 1, convergence_score: 0.164 },
            { round_index: 2, convergence_score: 0.000 },
            { round_index: 3, convergence_score: 0.060 }
        ];
        
        document.getElementById('test-data').innerHTML = `
            <p>Timeline length: ${testTimeline.length}</p>
            <p>Convergence scores: ${testTimeline.map(r => r.convergence_score.toFixed(3)).join(', ')}</p>
        `;
        
        function drawConvergenceChart(timeline) {
            console.log('Drawing chart with timeline:', timeline);
            
            const canvas = document.getElementById('convergenceChart');
            const ctx = canvas.getContext('2d');
            
            // Set canvas size
            canvas.width = canvas.offsetWidth;
            canvas.height = 200;
            
            console.log('Canvas size:', canvas.width, 'x', canvas.height);
            
            const width = canvas.width;
            const height = canvas.height;
            const padding = 40;
            
            // Clear canvas
            ctx.clearRect(0, 0, width, height);
            
            if (timeline.length === 0) {
                console.log('No timeline data');
                return;
            }
            
            // Extract convergence scores
            const scores = timeline.map(round => round.convergence_score);
            console.log('Scores:', scores);
            
            const maxScore = Math.max(...scores, 1.0);
            const minScore = Math.min(...scores, 0.0);
            console.log('Max score:', maxScore, 'Min score:', minScore);
            
            // Draw background
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, width, height);
            
            // Draw axes
            ctx.strokeStyle = '#333333';
            ctx.lineWidth = 2;
            
            // Y-axis
            ctx.beginPath();
            ctx.moveTo(padding, padding);
            ctx.lineTo(padding, height - padding);
            ctx.stroke();
            
            // X-axis
            ctx.beginPath();
            ctx.moveTo(padding, height - padding);
            ctx.lineTo(width - padding, height - padding);
            ctx.stroke();
            
            // Draw grid lines
            ctx.strokeStyle = '#dddddd';
            ctx.lineWidth = 1;
            for (let i = 0; i <= 10; i++) {
                const y = height - padding - (i / 10) * (height - 2 * padding);
                ctx.beginPath();
                ctx.moveTo(padding, y);
                ctx.lineTo(width - padding, y);
                ctx.stroke();
            }
            
            // Draw labels
            ctx.fillStyle = '#333333';
            ctx.font = '12px Arial';
            
            // Y-axis labels
            for (let i = 0; i <= 10; i++) {
                const y = height - padding - (i / 10) * (height - 2 * padding);
                const value = (i * 10) + '%';
                ctx.fillText(value, 5, y + 4);
            }
            
            // X-axis labels
            for (let i = 0; i < timeline.length; i++) {
                const x = padding + (i / Math.max(timeline.length - 1, 1)) * (width - 2 * padding);
                ctx.fillText(`R${i + 1}`, x - 10, height - 10);
            }
            
            // Draw convergence line
            if (timeline.length > 1) {
                ctx.strokeStyle = '#2563eb';
                ctx.lineWidth = 3;
                ctx.beginPath();
                
                for (let i = 0; i < timeline.length; i++) {
                    const x = padding + (i / Math.max(timeline.length - 1, 1)) * (width - 2 * padding);
                    const y = height - padding - (scores[i]) * (height - 2 * padding);
                    
                    console.log(`Point ${i}: x=${x}, y=${y}, score=${scores[i]}`);
                    
                    if (i === 0) {
                        ctx.moveTo(x, y);
                    } else {
                        ctx.lineTo(x, y);
                    }
                }
                
                ctx.stroke();
                
                // Draw points
                ctx.fillStyle = '#2563eb';
                for (let i = 0; i < timeline.length; i++) {
                    const x = padding + (i / Math.max(timeline.length - 1, 1)) * (width - 2 * padding);
                    const y = height - padding - (scores[i]) * (height - 2 * padding);
                    
                    ctx.beginPath();
                    ctx.arc(x, y, 4, 0, 2 * Math.PI);
                    ctx.fill();
                }
            } else {
                // Single point
                const x = padding + (width - 2 * padding) / 2;
                const y = height - padding - (scores[0]) * (height - 2 * padding);
                
                ctx.fillStyle = '#2563eb';
                ctx.beginPath();
                ctx.arc(x, y, 4, 0, 2 * Math.PI);
                ctx.fill();
            }
            
            document.getElementById('chart-debug').innerHTML = `
                <p>Chart drawn successfully!</p>
                <p>Timeline length: ${timeline.length}</p>
                <p>Scores: ${scores.map(s => s.toFixed(3)).join(', ')}</p>
                <p>Canvas size: ${canvas.width} x ${canvas.height}</p>
            `;
        }
        
        // Draw the chart
        drawConvergenceChart(testTimeline);
    </script>
</body>
</html>


